<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Detalhe da Solicitação</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="bg-light">
    <div class="container py-4">

      <h1 class="h4 mb-4">Detalhe da Solicitação</h1>

      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <p><strong>Nome:</strong> {{ solicitacao.nome|default:"-" }}</p>
          <p><strong>E-mail:</strong> {{ solicitacao.email|default:"-" }}</p>

          <p><strong>Setor:</strong>
            {% if solicitacao.setor %}
              {{ solicitacao.setor }}
            {% else %}
              -
            {% endif %}
          </p>

          <p><strong>Motivo:</strong><br>
            {% if solicitacao.motivo %}
              {{ solicitacao.motivo|linebreaks }}
            {% elif solicitacao.mensagem %}
              {{ solicitacao.mensagem|linebreaks }}
            {% else %}
              -
            {% endif %}
          </p>

          <p><strong>Status atual:</strong>
            {% if solicitacao.status %}
              {{ solicitacao.get_status_display|default:solicitacao.status }}
            {% else %}
              -
            {% endif %}
          </p>

          <p><strong>Data da Solicitação:</strong>
            {% if solicitacao.data_solicitacao %}
              {{ solicitacao.data_solicitacao|date:"d/m/Y H:i" }}
            {% elif solicitacao.data %}
              {{ solicitacao.data|date:"d/m/Y H:i" }}
            {% else %}
              -
            {% endif %}
          </p>

          {% if solicitacao.data_decisao %}
            <p><strong>Data da Decisão:</strong> {{ solicitacao.data_decisao|date:"d/m/Y H:i" }}</p>
          {% endif %}

          {% if solicitacao.observacao_admin %}
            <p><strong>Observação (Admin):</strong><br>{{ solicitacao.observacao_admin|linebreaks }}</p>
          {% endif %}
        </div>
      </div>

      <form method="POST" class="card shadow-sm">
        {% csrf_token %}
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Observação do administrador</label>
            <textarea name="observacao" class="form-control" rows="3"></textarea>
          </div>

          <div class="d-flex gap-2">
            <button name="acao" value="aprovar" class="btn btn-success">
              Aprovar
            </button>
            <button name="acao" value="negar" class="btn btn-danger">
              Negar
            </button>

            <!-- ✅ CORREÇÃO: namespace -->
            <a href="{% url 'solicitacoes:listar_solicitacoes' %}" class="btn btn-secondary ms-auto">
              Voltar
            </a>
          </div>
        </div>
      </form>

    </div>
  </body>
</html>
