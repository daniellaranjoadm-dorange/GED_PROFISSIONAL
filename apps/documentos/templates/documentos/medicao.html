{% extends "documentos/base.html" %}
{% load static %}

{% block title %}Medição – GED Profissional{% endblock %}

{% block content %}

<div class="doc-wrapper medicao-pro">

<style>
/* ============================
   MEDIÇÃO — PREMIUM GLASS (B)
   Escopo total: .doc-wrapper
============================ */
.doc-wrapper{
  --bg0:#060A12;
  --bg1:#0B1630;
  --glass: rgba(10, 24, 44, .52);
  --glass2: rgba(10, 24, 44, .36);
  --border: rgba(41, 217, 255, .22);
  --border2: rgba(255, 170, 0, .22);
  --text: #E7EEF8;
  --muted:#B8C7D9;
  --cyan:#29D9FF;
  --teal:#00FFC8;
  --orange:#FFB020;

  /* “fundo premium” só dentro do conteúdo */
  position: relative;
  padding: clamp(14px, 1.2vw, 22px);
  border-radius: 18px;

  background:
    radial-gradient(900px 420px at 14% 18%, rgba(41,217,255,.14), transparent 55%),
    radial-gradient(900px 420px at 85% 10%, rgba(255,176,32,.10), transparent 52%),
    radial-gradient(780px 520px at 70% 80%, rgba(0,255,200,.08), transparent 55%),
    linear-gradient(180deg, rgba(6,10,18,.04), rgba(6,10,18,.02));
  color: var(--text);
}

/* Título + subtítulo (reduz glow e melhora leitura) */
.doc-wrapper .medicao-title{
  color: var(--cyan);
  text-shadow:
    0 0 14px rgba(41,217,255,.28),
    0 0 28px rgba(41,217,255,.14);
  letter-spacing: .2px;
}
.doc-wrapper .page-subtitle{
  color: var(--muted);
  opacity: .92;
}

/* “pílula” glass reutilizável (aplicamos via seletores abaixo) */
.doc-wrapper .glass-panel{
  background: var(--glass);
  border: 1px solid var(--border);
  border-radius: 16px;
  box-shadow:
    0 14px 38px rgba(2,8,23,.18),
    inset 0 1px 0 rgba(255,255,255,.05);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

/* Aplica glass automaticamente nos blocos principais, sem mexer muito no HTML */
.doc-wrapper .medicao-card,
.doc-wrapper .totais-box,
.doc-wrapper .card,
.doc-wrapper .table-wrapper,
.doc-wrapper .chart-card,
.doc-wrapper .grafico-card,
.doc-wrapper .grafico-box,
.doc-wrapper .chart-box{
  background: var(--glass);
  border: 1px solid var(--border);
  border-radius: 16px;
  box-shadow:
    0 14px 38px rgba(2,8,23,.18),
    inset 0 1px 0 rgba(255,255,255,.05);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

/* KPI boxes (os dois cards do topo) */
.doc-wrapper .totais-box{
  background: linear-gradient(180deg, rgba(10,24,44,.58), rgba(10,24,44,.40));
}
.doc-wrapper .totais-box strong,
.doc-wrapper .totais-box .value{
  color: var(--text);
}
.doc-wrapper .totais-box .label{
  color: var(--muted);
}

/* Tabela finance premium */
.doc-wrapper .table-finance{
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  overflow: hidden;
}
.doc-wrapper .table-finance thead th{
  background: linear-gradient(90deg, rgba(41,217,255,.16), rgba(43,124,255,.10));
  color: var(--text);
  border-bottom: 1px solid rgba(255,255,255,.06);
}
.doc-wrapper .table-finance tbody tr{
  background: rgba(255,255,255,.03);
  transition: transform .18s ease, background .18s ease;
}
.doc-wrapper .table-finance tbody tr:hover{
  background: rgba(41,217,255,.10);
  transform: translateY(-1px);
}
.doc-wrapper .table-finance td,
.doc-wrapper .table-finance th{
  border-color: rgba(255,255,255,.06) !important;
}

/* Valores (mantém teu esquema, mas mais “premium”) */
.doc-wrapper .valor-usd{ color: var(--teal); font-weight: 700; }
.doc-wrapper .valor-brl{ color: #7CFFB6; font-weight: 700; }
.doc-wrapper .valor-nr { color: var(--orange); font-weight: 700; }

/* Botão Exportar (premium, sem ficar “apagado”) */
.doc-wrapper .btn-exportar{
  background: linear-gradient(180deg, rgba(255,176,32,.18), rgba(255,176,32,.10));
  border: 1px solid var(--border2);
  color: var(--text);
  border-radius: 999px;
  box-shadow: 0 10px 24px rgba(255,176,32,.12);
}
.doc-wrapper .btn-exportar:hover{
  background: linear-gradient(180deg, rgba(255,176,32,.28), rgba(255,176,32,.16));
  transform: translateY(-1px);
}

/* Caixas dos gráficos (os dois retângulos grandes) */
.doc-wrapper .grafico-area,
.doc-wrapper .charts-area{
  gap: 16px;
}
.doc-wrapper .grafico-area > *,
.doc-wrapper .charts-area > *{
  min-height: 220px;
}

/* Mobile: reduz sombras/padding */
@media (max-width: 768px){
  .doc-wrapper{ padding: 14px; border-radius: 14px; }
  .doc-wrapper .medicao-title{ font-size: 1.55rem; }
}
</style>



<div class="page-header">
    <div>
        <h1 class="text-info fw-bold" style="text-shadow: 0 0 8px #00eaff;">
            <i class="bi bi-cash-coin me-2"></i>Medição – Relatório Financeiro
        </h1>
        <div class="page-subtitle">
            Acompanhe os totais por tipo de documento e exporte os resultados.
        </div>
    </div>
</div>



<!-- ============================
     KPIs
============================ -->
<div class="row g-3 mb-4">
    <div class="col-md-4">
        <div class="totais-box">
            <h5 class="text-info fw-bold">Taxa de câmbio fixa</h5>
            <p class="valor-brl">R$ 5,7642</p>
        </div>
    </div>

    <div class="col-md-4">
        <div class="totais-box">
            <h5 class="text-info fw-bold">Valor por documento</h5>
            <p class="valor-usd">US$ {{ VALOR_MEDICAO_USD }}</p>
        </div>
    </div>

    <div class="col-md-4 text-end">
        <a href="{% url 'documentos:exportar_medicao_excel' %}" class="btn btn-primary btn-exportar px-4 py-2">
            <i class="bi bi-file-earmark-excel"></i> Exportar Excel
        </a>
    </div>
</div>




<!-- ============================
     TABELA PRINCIPAL
============================ -->
<div class="medicao-card">

    <h4 class="medicao-title mb-3">
        <i class="bi bi-ui-checks-grid"></i> Tabela de Medição por Tipo (Glass-Neon PRO)
    </h4>

    <div class="table-responsive">
        <table class="table-finance">
            <thead>
                <tr>
                    <th>Tipo Doc</th>
                    <th>Total</th>
                    <th>Emitidos</th>
                    <th>Não Recebidos</th>

                    <th>Valor Emitidos (USD)</th>
                    <th>Valor Emitidos (BRL)</th>

                    <th>Valor Não Recebidos (USD)</th>
                    <th>Valor Não Recebidos (BRL)</th>
                </tr>
            </thead>

            <tbody>
                {% for linha in linhas %}
                <tr>
                    <td class="fw-bold text-info">{{ linha.tipo_doc }}</td>
                    <td>{{ linha.total }}</td>
                    <td class="text-primary fw-bold">{{ linha.emitidos }}</td>
                    <td class="text-danger fw-bold">{{ linha.nao_recebidos }}</td>

                    <td class="valor-usd">US$ {{ linha.valor_emitidos_usd }}</td>
                    <td class="valor-brl">R$ {{ linha.valor_emitidos_brl }}</td>

                    <td class="valor-nr">US$ {{ linha.valor_nr_usd }}</td>
                    <td class="valor-nr">R$ {{ linha.valor_nr_brl }}</td>
                </tr>
                {% endfor %}
            </tbody>

            <tfoot>
                <tr style="background: rgba(0,255,200,0.15); font-weight:bold;">
                    <td>Total Geral</td>
                    <td>{{ totais.total_docs }}</td>
                    <td>{{ totais.total_emitidos }}</td>
                    <td>{{ totais.total_nao_recebidos }}</td>

                    <td class="valor-usd">US$ {{ totais.total_emitidos_usd }}</td>
                    <td class="valor-brl">R$ {{ totais.total_emitidos_brl }}</td>

                    <td class="valor-nr">US$ {{ totais.total_nr_usd }}</td>
                    <td class="valor-nr">R$ {{ totais.total_nr_brl }}</td>
                </tr>
            </tfoot>

        </table>
    </div>
</div>




<!-- ============================
     GRÁFICOS
============================ -->
<h4 class="medicao-title mt-5 mb-4">
    <i class="bi bi-bar-chart"></i> Gráficos da Medição
</h4>

<div class="row g-4 mb-5 charts-area">
    <div class="col-md-6">
        <div class="medicao-card">
            <canvas id="chartMedicaoBars"></canvas>
        </div>
    </div>

    <div class="col-md-6">
        <div class="medicao-card">
            <canvas id="chartMedicaoPie"></canvas>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const tipos = {{ tipos_js|safe }};
    const valoresUSD = {{ usd_js|safe }};
    const valoresBRL = {{ brl_js|safe }};

    /* GRÁFICO DE BARRAS */
    new Chart(document.getElementById("chartMedicaoBars"), {
        type: "bar",
        data: {
            labels: tipos,
            datasets: [{
                label: "Valor Total (BRL)",
                data: valoresBRL,
                backgroundColor: "rgba(0, 200, 255, 0.6)",
                borderColor: "rgba(0, 200, 255, 1)",
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    labels: { color: "#fff" }
                }
            },
            scales: {
                x: { ticks: { color: "#fff" } },
                y: { ticks: { color: "#fff" } }
            }
        }
    });

    /* GRÁFICO DE PIZZA */
    new Chart(document.getElementById("chartMedicaoPie"), {
        type: "pie",
        data: {
            labels: tipos,
            datasets: [{
                data: valoresUSD,
                backgroundColor: [
                    "#00eaff", "#00ffaa", "#ffae00", "#ff0099",
                    "#ffaa00", "#33ccff", "#66ff66", "#ff6666",
                    "#0099ff", "#ff9900", "#cc33ff", "#33ffcc"
                ]
            }]
        },
        options: {
            plugins: {
                legend: {
                    labels: { color: "#fff" }
                }
            }
        }
    });
</script>


</div>

{% endblock %}
