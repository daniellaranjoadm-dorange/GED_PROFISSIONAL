{% extends "documentos/base.html" %}
{% load static %}

{% block title %}Medição – GED Profissional{% endblock %}

{% block content %}

<div class="doc-wrapper">

<style>
/* ============================
   NOVO GLASS-NEON PRO
   ============================ */

.doc-wrapper .medicao-card {
    background: rgba(15, 23, 42, 0.06);
    border: 1px solid rgba(15, 23, 42, 0.10);
    border-radius: 16px;
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
}

.doc-wrapper .medicao-title {
    font-size: 26px;
    font-weight: 800;
    letter-spacing: .2px;
    color: var(--accent-blue);
    text-shadow: none;
}

/* ============================
     NOVA TABELA PREMIUM
============================ */
.doc-wrapper .table-finance {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    overflow: hidden;
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.75);
    border: 1px solid rgba(15, 23, 42, 0.10);
}

.doc-wrapper .table-finance thead th {
    background: rgba(56, 189, 248, 0.12);
    color: rgba(15, 23, 42, 0.85);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    font-size: .78rem;
    border-bottom: 1px solid rgba(15, 23, 42, 0.10);
}

.doc-wrapper .table-finance tbody tr {
    background: transparent;
    transition: background-color .15s ease;
}

.doc-wrapper .table-finance tbody tr:hover {
    background: rgba(56, 189, 248, 0.08);
    transform: none;
}

.doc-wrapper .table-finance td {
    padding: 10px;
    text-align: center;
    color: rgba(15, 23, 42, 0.80);
    border-top: 1px solid rgba(15, 23, 42, 0.06);
}

.doc-wrapper .valor-usd { color: rgba(2, 132, 199, 1); font-weight: 700; }
.doc-wrapper .valor-brl { color: rgba(22, 163, 74, 1); font-weight: 700; }
.doc-wrapper .valor-nr  { color: rgba(234, 88, 12, 1); font-weight: 700; }

.doc-wrapper .totais-box {
    background: rgba(15, 23, 42, 0.04);
    border: 1px solid rgba(15, 23, 42, 0.10);
    border-radius: 14px;
}

.doc-wrapper .btn-exportar {
    background: rgba(224, 96, 0, 0.10);
    border: 1px solid rgba(224, 96, 0, 0.35);
    color: rgba(15, 23, 42, 0.85);
    border-radius: 999px;
    padding: 10px 14px;
    font-weight: 700;
}

.doc-wrapper .btn-exportar:hover {
    background: rgba(224, 96, 0, 0.16);
    border-color: rgba(224, 96, 0, 0.55);
    color: rgba(15, 23, 42, 0.95);
}

.doc-wrapper .page-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
    margin-bottom: 1.5rem;
}

.doc-wrapper .page-subtitle {
    color: rgba(15, 23, 42, 0.65);
    font-size: 0.95rem;
}
</style>



<div class="page-header">
    <div>
        <h1 class="text-info fw-bold" style="text-shadow: 0 0 8px #00eaff;">
            <i class="bi bi-cash-coin me-2"></i>Medição – Relatório Financeiro
        </h1>
        <div class="page-subtitle">
            Acompanhe os totais por tipo de documento e exporte os resultados.
        </div>
    </div>
</div>



<!-- ============================
     KPIs
============================ -->
<div class="row g-3 mb-4">
    <div class="col-md-4">
        <div class="totais-box">
            <h5 class="text-info fw-bold">Taxa de câmbio fixa</h5>
            <p class="valor-brl">R$ {{ TAXA_CAMBIO_REAIS }}</p>
        </div>
    </div>

    <div class="col-md-4">
        <div class="totais-box">
            <h5 class="text-info fw-bold">Valor por documento</h5>
            <p class="valor-usd">US$ {{ VALOR_MEDICAO_USD }}</p>
        </div>
    </div>

    <div class="col-md-4 text-end">
        <a href="{% url 'documentos:exportar_medicao_excel' %}" class="btn btn-exportar px-4 py-2">
            <i class="bi bi-file-earmark-excel"></i> Exportar Excel
        </a>
    </div>
</div>




<!-- ============================
     TABELA PRINCIPAL
============================ -->
<div class="medicao-card">

    <h4 class="medicao-title mb-3">
        <i class="bi bi-ui-checks-grid"></i> Tabela de Medição por Tipo (Glass-Neon PRO)
    </h4>

    <div class="table-responsive">
        <table class="table-finance">
            <thead>
                <tr>
                    <th>Tipo Doc</th>
                    <th>Total</th>
                    <th>Emitidos</th>
                    <th>Não Recebidos</th>

                    <th>Valor Emitidos (USD)</th>
                    <th>Valor Emitidos (BRL)</th>

                    <th>Valor Não Recebidos (USD)</th>
                    <th>Valor Não Recebidos (BRL)</th>
                </tr>
            </thead>

            <tbody>
                {% for linha in linhas %}
                <tr>
                    <td class="fw-bold text-info">{{ linha.tipo_doc }}</td>
                    <td>{{ linha.total }}</td>
                    <td class="text-primary fw-bold">{{ linha.emitidos }}</td>
                    <td class="text-danger fw-bold">{{ linha.nao_recebidos }}</td>

                    <td class="valor-usd">US$ {{ linha.valor_emitidos_usd }}</td>
                    <td class="valor-brl">R$ {{ linha.valor_emitidos_brl }}</td>

                    <td class="valor-nr">US$ {{ linha.valor_nr_usd }}</td>
                    <td class="valor-nr">R$ {{ linha.valor_nr_brl }}</td>
                </tr>
                {% endfor %}
            </tbody>

            <tfoot>
                <tr style="background: rgba(0,255,200,0.15); font-weight:bold;">
                    <td>Total Geral</td>
                    <td>{{ totais.total_docs }}</td>
                    <td>{{ totais.total_emitidos }}</td>
                    <td>{{ totais.total_nao_recebidos }}</td>

                    <td class="valor-usd">US$ {{ totais.total_emitidos_usd }}</td>
                    <td class="valor-brl">R$ {{ totais.total_emitidos_brl }}</td>

                    <td class="valor-nr">US$ {{ totais.total_nr_usd }}</td>
                    <td class="valor-nr">R$ {{ totais.total_nr_brl }}</td>
                </tr>
            </tfoot>

        </table>
    </div>
</div>




<!-- ============================
     GRÁFICOS
============================ -->
<h4 class="medicao-title mt-5 mb-4">
    <i class="bi bi-bar-chart"></i> Gráficos da Medição
</h4>

<div class="row g-4 mb-5">
    <div class="col-md-6">
        <div class="medicao-card">
            <canvas id="chartMedicaoBars"></canvas>
        </div>
    </div>

    <div class="col-md-6">
        <div class="medicao-card">
            <canvas id="chartMedicaoPie"></canvas>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const tipos = {{ tipos_js|safe }};
    const valoresUSD = {{ usd_js|safe }};
    const valoresBRL = {{ brl_js|safe }};

    /* GRÁFICO DE BARRAS */
    new Chart(document.getElementById("chartMedicaoBars"), {
        type: "bar",
        data: {
            labels: tipos,
            datasets: [{
                label: "Valor Total (BRL)",
                data: valoresBRL,
                backgroundColor: "rgba(0, 200, 255, 0.6)",
                borderColor: "rgba(0, 200, 255, 1)",
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    labels: { color: "#fff" }
                }
            },
            scales: {
                x: { ticks: { color: "#fff" } },
                y: { ticks: { color: "#fff" } }
            }
        }
    });

    /* GRÁFICO DE PIZZA */
    new Chart(document.getElementById("chartMedicaoPie"), {
        type: "pie",
        data: {
            labels: tipos,
            datasets: [{
                data: valoresUSD,
                backgroundColor: [
                    "#00eaff", "#00ffaa", "#ffae00", "#ff0099",
                    "#ffaa00", "#33ccff", "#66ff66", "#ff6666",
                    "#0099ff", "#ff9900", "#cc33ff", "#33ffcc"
                ]
            }]
        },
        options: {
            plugins: {
                legend: {
                    labels: { color: "#fff" }
                }
            }
        }
    });
</script>


</div>

{% endblock %}
